---
layout: post
status: publish
published: true
title: 'Introduction to Ant Part 1: A Basic Build'
author:
  display_name: Shrimp
  login: shrimp
  email: shrimp@shrimpworks.za.net
  url: http://shrimpworks.za.net/
author_login: shrimp
author_email: shrimp@shrimpworks.za.net
author_url: http://shrimpworks.za.net/
wordpress_id: 800
wordpress_url: http://shrimpworks.za.net/?p=800
date: '2015-07-07 21:01:04 +0200'
date_gmt: '2015-07-07 19:01:04 +0200'
categories:
- Development
tags:
- Tutorials
- Java
- Ant
---
<p><img src="http://shrimpworks.za.net/wp-content/uploads/2015/07/101702-150x150.png" alt="" width="200" height="200" class="alignleft" /><a href="https://ant.apache.org/">Apache Ant</a> is a general-purpose build tool, primarily used for the building of Java applications, but it is flexible enough to be used for various tasks.</p>
<p>In the Java world at least, Ant seems to be largely passed over for the immediate convenience and IDE support of Maven, however long term, I believe a good set of Ant scripts offer far more flexibility and room for tweaking your build processes. The downside is that there's a lot of stuff you need to learn and figure out and build by hand.</p>
<p>In this series of tutorials, I'll try to document the process of learning I've gone through building and maintaining Ant build files, from the most basic of "just compile my stuff" steps to automatic generation of JavaDoc output, dependency management using Ant's companion, <a href="https://ant.apache.org/ivy/">Ivy</a>, unit testing using <a href="http://junit.org/">JUnit</a>, and integrating with some additional tools I've been using, such as <a href="http://checkstyle.sourceforge.net/">Checkstyle</a> and <a href="http://findbugs.sourceforge.net/">FindBugs</a>.</p>
<p>For part 1 of this tutorial, I've created a simple Hello World library. It doesn't have a main executable itself, the goal of this is to produce a <code>.jar</code> file we can include in other projects, to start our Ant script off fairly simply.</p>
<p>The source for this project can be <a href="https://github.com/shrimpza/ant-tutorial/tree/master/part01">found in GitHub</a>. Here's the breakdown of everything going on in this project:</p>
<p><a id="more"></a><a id="more-800"></a></p>
<p>At the root of the project, we have the <code>src</code> directory, under which all our packages live. Normally, an IDE will take care of this sort of structure for you automatically, since it's the most commonly accepted way of structuring a Java project. Also in the root of the project, you'll find the <code>build.xml</code> file - this is our Ant build configuration.</p>
<p>Digging into the various parts of the Ant file, starting at the top and working our way down:</p>
<pre class="prettyprint"><code class="language-xml"><?xml version="1.0" encoding="UTF-8"?>
<project name="hello-world" default="dist" basedir=".">
</code></pre>
<p>First is a standard XML version and encoding declaration - Ant won't complain if this is missing, but it's a good idea to include in any XML documents anyway.</p>
<p>The next line shows the <a href="https://ant.apache.org/manual/using.html#projects">project</a> definition. <code>name</code> is the name of the project, which we'll also use as the output file name for our <code>.jar</code> file and any other distributable packages and artefacts - you'll see this referred to as the variable <code>${ant.project.name}</code> elsewhere.</p>
<p>The <code>default</code> attribute indicates the default <a href="https://ant.apache.org/manual/targets.html#targets">target</a> which will be run when you execute <code>ant</code> with no target specified. Targets are defined in <code>&lt;target ...&gt;</code> blocks, which we'll see later.</p>
<pre class="prettyprint"><code class="language-xml">    <!-- basic paths -->
    <property name="src.dir" location="src"/>
    <property name="dist.dir" location="dist"/>
    <property name="build.dir" location="build"/>
</code></pre>
<p>Here we're defining a couple of path <a href="https://ant.apache.org/manual/Tasks/property.html">properties</a> which will be used elsewhere in the script. Often these are defined in an external <code>.properties</code> file and imported via a <code>&ltproperty file="my.properties"/&gt;</code> line, but for a few simple properties like these, I prefer defining them in the actual XML, to save the clutter of an additional file.</p>
<p>In particular, we're defining the source code path (<code>.java</code> files), as well as output paths for the compiled <code>.class</code> files and our redistributable artefacts.</p>
<pre class="prettyprint"><code class="language-xml">    <!-- properties for build output, nothing should need to change beyond this point -->
    <property name="build.src.dir" location="${build.dir}/src"/>

    <path id="default.classpath">
        <pathelement path="${build.src.dir}"/>
    </path>
</code></pre>
<p>These are properties building on the more commonly defined ones in the previous block. This is defining a sub-directory for the <code>.class</code> file output under the configured build path, as well as defining a <a href="https://ant.apache.org/manual/using.html#path">class path</a>, which will be used for when we actually call <code>javac</code> to compile our code, so it knows where everything is.</p>
<pre class="prettyprint"><code class="language-xml">    <!-- Simple source build -->
    <target name="build" description="compile source">
        <mkdir dir="${build.src.dir}"/>

        <javac srcdir="${src.dir}" destdir="${build.src.dir}" includeantruntime="false">
            <classpath refid="default.classpath"/>
        </javac>
    </target>
</code></pre>
<p>Now we're finally getting to a build target. A target is typically one of the names you pass via the command line (or via your IDE, if it has Ant support) to Ant to perform a certain type of build or task.</p>
<p>For example, we'd invoke the above <code>build</code> target from the command line as follows: <code>ant build</code></p>
<p>This would ignore the <code>default</code> attribute set in the <code>project</code> definition, and go straight to the <code>build</code> step.</p>
<p>Let's break down what's going on in this target.</p>
<p>Firstly, we need to make sure the output directory using the <a href="https://ant.apache.org/manual/Tasks/mkdir.html">mkdir task</a>. The variable <code>${build.src.dir}</code> being referenced here was defined in a property in the previous block, and essentially resolves to <code>project-root/build/src</code>. The <code>mkdir</code> task ensures all parent directories are created as well if they don't yet exist.</p>
<p>Next, we're invoking <code>javac</code> to compile our code using the built-in <a href="https://ant.apache.org/manual/Tasks/javac.html">javac task</a>. The <code>srcdir</code> directory references the source path property we defined near the top of the build script, and the <code>destdir</code> references the build output directory that was just created with <code>mkdir</code>. <code>includeantruntime</code> is set to false to exclude Ant including itself in the classpath -- I've never encountered a reason to do this; but it defaults to True so we should explicitly disable it.</p>
<p>Finally, the <code>classpath</code> property within the <code>javac</code> instruction is making sure our build class path is made available during the build.</p>
<p>In summary, this task will compile all our source into <code>.class</code> files, and if there are any compilation errors, will report on those via standard console output and stop the build process. Feel free to investigate the additional properties and attributes the <a href="https://ant.apache.org/manual/Tasks/javac.html">javac task</a> makes available -- there are many.</p>
<pre class="prettyprint"><code class="language-xml">    <!-- Build distribution -->
    <target name="dist" depends="build" description="generate distribution">
        <mkdir dir="${dist.dir}"/>

        <jar jarfile="${dist.dir}/${ant.project.name}.jar">
            <fileset dir="${build.src.dir}"/>
            <fileset dir="${src.dir}" excludes="**/*.java"/>
        </jar>
    </target>
</code></pre>
<p>At last, and probably the most commonly used target, <code>dist</code>. This is generally used for building and packaging your redistributables. Note that the target names used here, <code>build</code>, <code>dist</code>, <code>clean</code> and others we'll be adding over time and not fixed, you may name them anything you like, these are simply the most commonly used and generally accepted. Let's see what this one's doing.</p>
<p>Firstly, you will notice the addition of the <code>depends</code> attribute to the <code>target</code> tag. As the name suggests, this target depends on the <code>build</code> target. When you invoke the <code>dist</code> target directly, Ant will automatically execute any dependency targets. This way we can chain complex series of build targets together to orchestrate various bits of behaviour without needing to re-define everything for every target. A target may also depend on more than one other target, and these are defined as a comma-separated list - Ant will execute those dependencies in the order they are listed.</p>
<p>The first instruction within the target is the familiar <code>mkdir</code> to prepare the output directory, again referencing a property we defined earlier.</p>
<p>Next, the built-in <a href="https://ant.apache.org/manual/Tasks/jar.html">jar task</a> is responsible for packaging the build output into a <code>.jar</code> file we can use in other projects.</p>
<p>The <code>jarfile</code> attribute defines the output file. In this example, it will resolve to <code>project-root/dist/hello-world.jar</code>.</p>
<p>The first <code>fileset</code> property is letting the <code>jar</code> task know where to find the compiled <code>.class</code> files to be included in the final <code>.jar</code> file - hence the need for this target to depend on the <code>build</code> one first. </p>
<p>The second <code>fileset</code> is for the inclusion of <em>resource</em> files stored alongside the source files, within the final package. For example, these would be files you may typically read or access at runtime via a <code>getClass().getResource(...)</code> call. If your applications are likely to never make use of such functionality, it's safe to remove this, but it's handy to have available for the time you may.</p>
<p>That's all. After this target executes, your <code>build</code> directory will contain a bunch of compiled <code>.class</code> files, and you'll have a distributable <code>.jar</code> file in the <code>dist</code> directory.</p>
<pre class="prettyprint"><code class="language-xml">    <!-- Clean compiled files -->
    <target name="clean" description="clean up" >
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
    </target>
</code></pre>
<p>It is generally a good idea to include a <code>clean</code> operation in build files, which should remove <em>all</em> output generated by a build. Essentially this should return the project to it's freshly checked out state, with no extraneous files and directories.</p>
<p>Here, we're only making use of the <a href="https://ant.apache.org/manual/Tasks/delete.html">delete task</a>, which will remove the contents of the paths specified, as well we the paths themselves. When you extend your builds to perform more interesting things, and you end up creating more directories or files, make sure to clean them up.</p>
<p>That's all there is to a simple build script, which at this point, is perfectly usable for creating simple stand-alone libraries, which don't depend on any external libraries, and which don't need to be run as stand-alone applications.</p>
<p>In the next part, we'll see how our application can be made runnable.</p>
<hr/>
<p>Other parts in this series:</p>
<p><a href="http://shrimpworks.za.net/2015/07/11/introduction-to-ant-part-2-runnable-jar-file/">Part 2: A Runnable Jar File</a><br />
<a href="http://shrimpworks.za.net/2015/08/07/introduction-to-ant-part-3-dependency-management-with-ivy/">Part 3: Dependency Management with Ivy</a><br />
<a href="http://shrimpworks.za.net/2015/09/18/introduction-to-ant-part-4-unit-tests-with-junit/">Part 4: Unit Tests with JUnit</a></p>
